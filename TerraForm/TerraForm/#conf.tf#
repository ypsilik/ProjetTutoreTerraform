#Configuration du provider

provider "openstack" {
	 user_name = "admin"
	 tenant_name = "admin"
	 password = "mot de passe"
	 auth_url = "Identité url d'authentifacation"
}

#Creation d'une ressource volume V1 dans Openstack

resource "openstack_blockstorage_volume_v1" "volume_1" {
	 region = "Region ou le volume est crée"
	 name   = "volume_1"
	 description = "Description du volume"
	 size = "Taille du volume en Gigaoctets"
}

#Creation d'une vm au seins de Openstack avec le volume v1

resource "openstack_compute_instance_v2" "volume-attached" {
	 name = "volume_attached"
	 image_id = "Image souhaiter pour le serveur"
	 flavor_id = "hardware pour le serveur"
	 key_pair = "${openstack_compute_keypair_v2.test-keypair.id"
	 security_groups = ["default"]"Groupe de sécurité associer			       au serveur"


	 network {
	  name = "my_network"
	 }

	 volume {
	 	volume_id = "${openstack_blockstorage_volume_v1
			     .volume_1.id}"
	}
}

resource "openstack_compute_keypair_v2" "test-keypair" {
  name = "my-keypair"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAjpC1hwiOCCmKEWxJ4qzTTsJbKzndLotBCz5PcwtUnflmU+gHJtWMZKpuEGVi29h0A/+ydKek1O18k10Ff+4tyFjiHDQAnOfgWf7+b1yK+qDip3X1C0UPMbwHlTfSGWLGZqd9LvEFx9k3h/M+VtMvwR1lJ9LUyTAImnNjWG7TaIPmui30HvM2UiFEmqkr4ijq45MyX2+fLIePLRIF61p4whjHAQYufqyno3BS48icQb4p6iVEZPo4AE2o9oIyQvj2mx4dk5Y8CgSETOZTYDOR3rU2fZTRDRgPJDH9FWvQjF5tA0p3d9CoWWd2s6GKKbfoUIi8R/Db1BSPJwkqB"
}